# Работа сессий

## Надо
- Показывать каждое подключение
- Показывать пользователей онлайн
- Запоминать подключение и сессий пользователей, чтобы не вводить каждый раз пароль
- Механизм чистки старых сессий, или не нужных

## Если...
- Поменялся ip адрес, пользователь зашёл из дургого места но с того же устройства
- Пользователь зашёл спустя время, запоминать дату входа для лога? (Запоминать каждое подключение)
### Ответы
В таблице сессий у сессий есть уникальный id, можно делать кучу записей сессий с одинаковой сессией для каждого подключения, каждого ip, и вычленять по дате последнюю актуальную для сравнения

## Дано
- Таблица пользователей
- Таблица устройств
- Таблица сессий

## Сценарий подключение
### Общий
- Если уже есть сессия в локаль сторедж, отправляем её на проверку
-- Такая сессия есть в базе, ip не менялся, обновляем значение даты последнего посещения
-- Такая сессия есть в базе, ip менялся, добавляем новую сессию, + id пользователя
-- Такая сессия есть в базе, push не менялся, обновляем значение даты последнего посещения
-- Такая сессия есть в базе, push менялся, добавляем новую сессию, + id пользователя
- Если сессии нет, отправляем запрос на создание с id пользователя 0
- Если авторизация, добавляем к сессии id пользователя

### Аноним
- Записываем только сессию из php в локаль сторедж
- Записываем сессию из php в базу сессий с ip и другими данными

### Авторизированный пользователь
- Записываем сессию в локаль, или обновляем
- Записываем сессию из php в базу сессий с ip и другими данными

## Отключение
- Удаляем сессию PHP
- Удаляем все данные о пользователе из сесcии по хэшу, чтобы не выйти с других устройств

# Дополнительные работы
- Нужно ли предупреждать о новом ip?
- Ограничение на количество устройств онлайн?
